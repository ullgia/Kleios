@using Kleios.Shared.Settings

<MudDialog>
    <DialogContent>
        <MudAlert Severity="Severity.Warning" Class="mb-4">
            <MudText Typo="Typo.body1">
                Sei sicuro di voler eliminare l'impostazione <strong>@Setting.Key</strong>?
            </MudText>
        </MudAlert>
        
        <MudSimpleTable Dense="true" Bordered="true" Class="mb-3">
            <tbody>
                <tr>
                    <td><strong>Chiave:</strong></td>
                    <td><code>@Setting.Key</code></td>
                </tr>
                <tr>
                    <td><strong>Categoria:</strong></td>
                    <td>@Setting.Category</td>
                </tr>
                <tr>
                    <td><strong>Valore:</strong></td>
                    <td>@GetDisplayValue()</td>
                </tr>
                <tr>
                    <td><strong>Descrizione:</strong></td>
                    <td>@Setting.Description</td>
                </tr>
            </tbody>
        </MudSimpleTable>
        
        <MudText Typo="Typo.body2" Color="Color.Error" Class="mt-4">
            <strong>Attenzione:</strong> Questa operazione è irreversibile e potrebbe causare malfunzionamenti del sistema!
        </MudText>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Annulla</MudButton>
        <MudButton Color="Color.Error" 
                   Variant="Variant.Filled" 
                   OnClick="Confirm"
                   Disabled="_deleting">
            @if (_deleting)
            {
                <MudProgressCircular Class="mr-2" Size="Size.Small" Indeterminate="true" />
            }
            Elimina
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] 
    IMudDialogInstance MudDialog { get; set; } = null!;
    
    [Parameter]
    public SettingMetadata Setting { get; set; } = null!;
    
    private bool _deleting;

    private string GetDisplayValue()
    {
        if (Setting.DataType == "Password" && !string.IsNullOrEmpty(Setting.Value))
        {
            return "••••••••";
        }

        return Setting.Value ?? "-";
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }

    private void Confirm()
    {
        _deleting = true;
        MudDialog.Close(DialogResult.Ok(true));
    }
}
